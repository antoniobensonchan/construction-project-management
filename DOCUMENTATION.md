# å»ºç­‘é¡¹ç›®ç®¡ç†ç³»ç»Ÿ - å®Œæ•´æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§)
3. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
4. [å®‰è£…éƒ¨ç½²](#å®‰è£…éƒ¨ç½²)
5. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
6. [APIæ–‡æ¡£](#apiæ–‡æ¡£)
7. [å¼€å‘æŒ‡å—](#å¼€å‘æŒ‡å—)
8. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
9. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ç³»ç»Ÿæ¦‚è¿°

å»ºç­‘é¡¹ç›®ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„Webåº”ç”¨ï¼Œä¸“ä¸ºå»ºç­‘è¡Œä¸šè®¾è®¡ï¼Œæä¾›é¡¹ç›®ç®¡ç†ã€ä»»åŠ¡è·Ÿè¸ªã€å›¾çº¸æ ‡æ³¨ã€ç”˜ç‰¹å›¾å¯è§†åŒ–ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

### æ ¸å¿ƒä»·å€¼
- **æé«˜æ•ˆç‡**: æ•°å­—åŒ–ç®¡ç†å‡å°‘äººå·¥æˆæœ¬
- **ç²¾ç¡®è·Ÿè¸ª**: å®æ—¶è¿›åº¦ç›‘æ§å’ŒæŠ¥å‘Š
- **åä½œå¢å¼º**: å¤šç”¨æˆ·åä½œå’Œæƒé™ç®¡ç†
- **æ•°æ®å®‰å…¨**: åŸºäºå…¬å¸çš„æ•°æ®éš”ç¦»

## åŠŸèƒ½ç‰¹æ€§

### ğŸ—ï¸ é¡¹ç›®ç®¡ç†
- **é¡¹ç›®åˆ›å»º**: æ”¯æŒé¡¹ç›®åŸºæœ¬ä¿¡æ¯ã€æ—¶é—´è®¡åˆ’è®¾ç½®
- **å·¥åœ°ç®¡ç†**: å¤šå·¥åœ°æ”¯æŒï¼Œæ¯ä¸ªå·¥åœ°ç‹¬ç«‹ç®¡ç†
- **è¿›åº¦è·Ÿè¸ª**: åŸºäºæ—¶é—´å’Œä»»åŠ¡å®Œæˆæƒ…å†µçš„æ™ºèƒ½è¿›åº¦è®¡ç®—
- **çŠ¶æ€ç®¡ç†**: é¡¹ç›®çŠ¶æ€æµè½¬ï¼ˆè§„åˆ’ä¸­â†’è¿›è¡Œä¸­â†’å·²å®Œæˆï¼‰

### ğŸ“‹ ä»»åŠ¡ç®¡ç†
- **å±‚çº§ç»“æ„**: ä¸»ä»»åŠ¡å’Œå­ä»»åŠ¡çš„å®Œæ•´å±‚çº§ç®¡ç†
- **ä»»åŠ¡ç±»å‹**: æ–°å»ºæ–½å·¥ã€æ•´æ”¹ä¿®å¤ã€æ£€æŸ¥éªŒæ”¶ã€ç»´æŠ¤ä¿å…»
- **çŠ¶æ€è·Ÿè¸ª**: å¼€æ”¾â†’è¿›è¡Œä¸­â†’å¾…å¤„ç†â†’å·²å®Œæˆ
- **ä¾èµ–ç®¡ç†**: å››ç§ä¾èµ–ç±»å‹ï¼ˆFSã€SSã€FFã€SFï¼‰
- **å¾ªç¯æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å’Œé˜²æ­¢å¾ªç¯ä¾èµ–

### ğŸ“Š ç”˜ç‰¹å›¾å¯è§†åŒ–
- **æ—¶é—´è½´æ˜¾ç¤º**: æ¨ªå‘å±•ç¤ºé¡¹ç›®å…¨å‘¨æœŸ
- **å·¥åœ°åˆ†ç»„**: æŒ‰å·¥ä½œåœ°ç‚¹åˆ†ç»„æ˜¾ç¤ºä»»åŠ¡
- **ä»»åŠ¡å±‚çº§**: æ¸…æ™°çš„ä¸»ä»»åŠ¡â†’å­ä»»åŠ¡ç»“æ„
- **è¿›åº¦å¯è§†åŒ–**: é¢œè‰²ç¼–ç å’Œè¿›åº¦æ¡æ˜¾ç¤º
- **PDFå¯¼å‡º**: ä¸“ä¸šçš„ç”˜ç‰¹å›¾PDFæŠ¥å‘Š

### ğŸ“ å›¾çº¸ç®¡ç†
- **PDFä¸Šä¼ **: æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼Œæ–‡ä»¶éªŒè¯
- **åœ¨çº¿é¢„è§ˆ**: PDF.jsæ”¯æŒçš„åœ¨çº¿æŸ¥çœ‹
- **æ ‡æ³¨åŠŸèƒ½**: ç‚¹ã€çº¿ã€çŸ©å½¢ã€æ–‡æœ¬æ ‡æ³¨
- **æ ‡æ³¨ç®¡ç†**: æ ‡æ³¨ç¼–è¾‘ã€åˆ é™¤ã€æ‰¹é‡æ“ä½œ

### ğŸ‘¥ ç”¨æˆ·ç®¡ç†
- **å…¬å¸éš”ç¦»**: åŸºäºå…¬å¸çš„æ•°æ®å®Œå…¨éš”ç¦»
- **æƒé™æ§åˆ¶**: ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±å…¬å¸çš„æ•°æ®
- **å®‰å…¨è®¤è¯**: å®Œæ•´çš„ç™»å½•ã€æ³¨å†Œã€æ³¨é”€æµç¨‹

## æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„
```
Django 4.2.7
â”œâ”€â”€ Core Module (æ ¸å¿ƒæ¨¡å—)
â”‚   â”œâ”€â”€ Mixins (æ··å…¥ç±»)
â”‚   â”œâ”€â”€ Utils (å·¥å…·å‡½æ•°)
â”‚   â””â”€â”€ Base Views (åŸºç¡€è§†å›¾)
â”œâ”€â”€ Accounts (ç”¨æˆ·è®¤è¯)
â”œâ”€â”€ Projects (é¡¹ç›®ç®¡ç†)
â”œâ”€â”€ Tasks (ä»»åŠ¡ç®¡ç†)
â”œâ”€â”€ Drawings (å›¾çº¸ç®¡ç†)
â””â”€â”€ Gantt (ç”˜ç‰¹å›¾)
```

### å‰ç«¯æŠ€æœ¯æ ˆ
- **HTML5 + CSS3**: ç°ä»£Webæ ‡å‡†
- **Bootstrap 5**: å“åº”å¼UIæ¡†æ¶
- **JavaScript ES6+**: ç°ä»£JavaScriptç‰¹æ€§
- **PDF.js**: PDFæ–‡ä»¶å¤„ç†
- **Canvas API**: å›¾çº¸æ ‡æ³¨åŠŸèƒ½

### æ•°æ®åº“è®¾è®¡
```sql
-- æ ¸å¿ƒå®ä½“å…³ç³»
User (ç”¨æˆ·)
â”œâ”€â”€ Project (é¡¹ç›®) 1:N
    â”œâ”€â”€ WorkSite (å·¥åœ°) 1:N
        â”œâ”€â”€ Task (ä»»åŠ¡) 1:N
        â”‚   â”œâ”€â”€ SubTask (å­ä»»åŠ¡) 1:N
        â”‚   â””â”€â”€ TaskDependency (ä¾èµ–) N:N
        â””â”€â”€ Drawing (å›¾çº¸) 1:N
            â””â”€â”€ Annotation (æ ‡æ³¨) 1:N
```

## å®‰è£…éƒ¨ç½²

### å¼€å‘ç¯å¢ƒ
```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd ConstructionPMProject

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. æ•°æ®åº“è¿ç§»
python manage.py makemigrations
python manage.py migrate

# 5. åˆ›å»ºè¶…çº§ç”¨æˆ·
python manage.py createsuperuser

# 6. å¯åŠ¨æœåŠ¡
python manage.py runserver
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# 1. å®‰è£…ç”Ÿäº§ä¾èµ–
pip install gunicorn whitenoise

# 2. é…ç½®ç¯å¢ƒå˜é‡
export DEBUG=False
export ALLOWED_HOSTS=your-domain.com
export SECRET_KEY=your-secret-key

# 3. æ”¶é›†é™æ€æ–‡ä»¶
python manage.py collectstatic

# 4. å¯åŠ¨Gunicorn
gunicorn construction_pm.wsgi:application --bind 0.0.0.0:8000
```

### Dockeréƒ¨ç½²
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .
RUN python manage.py collectstatic --noinput

EXPOSE 8000
CMD ["gunicorn", "construction_pm.wsgi:application", "--bind", "0.0.0.0:8000"]
```

## ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹
1. **æ³¨å†Œè´¦æˆ·**: å¡«å†™å…¬å¸ä¿¡æ¯å’Œç”¨æˆ·ä¿¡æ¯
2. **åˆ›å»ºé¡¹ç›®**: è®¾ç½®é¡¹ç›®åŸºæœ¬ä¿¡æ¯å’Œæ—¶é—´è®¡åˆ’
3. **æ·»åŠ å·¥åœ°**: ä¸ºé¡¹ç›®æ·»åŠ æ–½å·¥å·¥åœ°
4. **åˆ›å»ºä»»åŠ¡**: æ·»åŠ ä¸»ä»»åŠ¡å’Œå­ä»»åŠ¡
5. **ä¸Šä¼ å›¾çº¸**: ä¸Šä¼ PDFå›¾çº¸å¹¶æ·»åŠ æ ‡æ³¨
6. **æŸ¥çœ‹ç”˜ç‰¹å›¾**: å¯è§†åŒ–é¡¹ç›®è¿›åº¦

### æ ¸å¿ƒå·¥ä½œæµç¨‹
```
é¡¹ç›®åˆ›å»º â†’ å·¥åœ°è®¾ç½® â†’ ä»»åŠ¡è§„åˆ’ â†’ å›¾çº¸ä¸Šä¼  â†’ æ ‡æ³¨æ·»åŠ  â†’ è¿›åº¦è·Ÿè¸ª â†’ ç”˜ç‰¹å›¾æŸ¥çœ‹ â†’ PDFå¯¼å‡º
```

### ä»»åŠ¡ä¾èµ–è®¾ç½®
- **å®Œæˆ-å¼€å§‹ (FS)**: Aä»»åŠ¡å®ŒæˆåBä»»åŠ¡æ‰èƒ½å¼€å§‹
- **å¼€å§‹-å¼€å§‹ (SS)**: Aä»»åŠ¡å¼€å§‹åBä»»åŠ¡æ‰èƒ½å¼€å§‹
- **å®Œæˆ-å®Œæˆ (FF)**: Aä»»åŠ¡å®ŒæˆåBä»»åŠ¡æ‰èƒ½å®Œæˆ
- **å¼€å§‹-å®Œæˆ (SF)**: Aä»»åŠ¡å¼€å§‹åBä»»åŠ¡æ‰èƒ½å®Œæˆ

## APIæ–‡æ¡£

### ç”˜ç‰¹å›¾API
```http
GET /gantt/api/project/{project_id}/data/
Content-Type: application/json

Response:
{
  "project": {...},
  "worksites": [...],
  "tasks": [...],
  "dependencies": [...]
}
```

### ä»»åŠ¡ä¾èµ–API
```http
POST /tasks/{task_id}/dependency/add/
Content-Type: application/json

{
  "predecessor_id": 1,
  "dependency_type": "FS",
  "lag_days": 0
}
```

### å­ä»»åŠ¡API
```http
POST /tasks/{parent_task_id}/subtask/create/
Content-Type: application/json

{
  "name": "å­ä»»åŠ¡åç§°",
  "responsible_person": "è´Ÿè´£äºº",
  "start_date": "2025-01-01",
  "end_date": "2025-01-10",
  "deadline": "2025-01-15"
}
```

## å¼€å‘æŒ‡å—

### ä»£ç ç»“æ„
```
core/
â”œâ”€â”€ mixins.py          # é€šç”¨æ··å…¥ç±»
â”œâ”€â”€ utils.py           # å·¥å…·å‡½æ•°
â””â”€â”€ views.py           # åŸºç¡€è§†å›¾ç±»

apps/
â”œâ”€â”€ accounts/          # ç”¨æˆ·è®¤è¯
â”œâ”€â”€ projects/          # é¡¹ç›®ç®¡ç†
â”œâ”€â”€ tasks/            # ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ drawings/         # å›¾çº¸ç®¡ç†
â””â”€â”€ gantt/           # ç”˜ç‰¹å›¾
```

### æ ¸å¿ƒæ··å…¥ç±»
- **UserOwnedMixin**: ç”¨æˆ·æ•°æ®éš”ç¦»
- **OptimizedQueryMixin**: æŸ¥è¯¢ä¼˜åŒ–
- **DateValidationMixin**: æ—¥æœŸéªŒè¯
- **CacheMixin**: ç¼“å­˜æ”¯æŒ
- **APIResponseMixin**: APIå“åº”æ ¼å¼åŒ–

### å¼€å‘è§„èŒƒ
```python
# è§†å›¾ç»§æ‰¿ç¤ºä¾‹
class ProjectListView(BaseListView):
    model = Project
    template_name = 'projects/list.html'
    search_fields = ['name', 'description']
    
# è¡¨å•éªŒè¯ç¤ºä¾‹
class ProjectForm(forms.ModelForm, FormValidationMixin):
    def clean(self):
        return self.validate_date_fields()
```

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- **æŸ¥è¯¢ä¼˜åŒ–**: ä½¿ç”¨select_relatedå’Œprefetch_related
- **ç´¢å¼•ä¼˜åŒ–**: ä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- **æ‰¹é‡æ“ä½œ**: ä½¿ç”¨bulk_createå’Œbulk_update

### ç¼“å­˜ç­–ç•¥
```python
# è§†å›¾ç¼“å­˜
@cache_page(300)
def project_list(request):
    pass

# æ¨¡æ¿ç‰‡æ®µç¼“å­˜
{% cache 300 project_stats project.id %}
    <!-- é¡¹ç›®ç»Ÿè®¡ä¿¡æ¯ -->
{% endcache %}

# æŸ¥è¯¢ç»“æœç¼“å­˜
@cache_model_method(timeout=300)
def get_progress_percentage(self):
    pass
```

### å‰ç«¯ä¼˜åŒ–
- **é™æ€æ–‡ä»¶å‹ç¼©**: ä½¿ç”¨WhiteNoise
- **å›¾ç‰‡ä¼˜åŒ–**: è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾
- **æ‡’åŠ è½½**: å¤§åˆ—è¡¨åˆ†é¡µåŠ è½½
- **CDN**: é™æ€èµ„æºCDNåŠ é€Ÿ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æ•°æ®åº“è¿ç§»å¤±è´¥**
```bash
# é‡ç½®è¿ç§»
python manage.py migrate --fake-initial
python manage.py migrate
```

**2. é™æ€æ–‡ä»¶404**
```python
# settings.py
STATIC_ROOT = BASE_DIR / 'staticfiles'
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage'
```

**3. PDFä¸Šä¼ å¤±è´¥**
```python
# æ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶
FILE_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024  # 10MB
DATA_UPLOAD_MAX_MEMORY_SIZE = 10 * 1024 * 1024  # 10MB
```

**4. ç”˜ç‰¹å›¾æ˜¾ç¤ºå¼‚å¸¸**
- æ£€æŸ¥ä»»åŠ¡æ—¥æœŸæ˜¯å¦è®¾ç½®
- éªŒè¯é¡¹ç›®æ—¶é—´èŒƒå›´
- ç¡®è®¤æµè§ˆå™¨JavaScriptæ”¯æŒ

### æ—¥å¿—åˆ†æ
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/construction_pm.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep ERROR logs/construction_pm.log

# æ€§èƒ½åˆ†æ
grep "executed in" logs/construction_pm.log
```

### æ€§èƒ½ç›‘æ§
```python
# æ•°æ®åº“æŸ¥è¯¢ç›‘æ§
from django.db import connection
print(f"Queries: {len(connection.queries)}")

# å†…å­˜ä½¿ç”¨ç›‘æ§
import psutil
print(f"Memory: {psutil.virtual_memory().percent}%")
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2025å¹´9æœˆ6æ—¥  
**ç»´æŠ¤å›¢é˜Ÿ**: Construction PM Development Team
